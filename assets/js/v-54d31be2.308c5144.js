"use strict";(self.webpackChunkcclc_vuepress=self.webpackChunkcclc_vuepress||[]).push([[1412],{4941:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-54d31be2",path:"/frontend/canvas-zoom-img-by-selecting-area.html",title:"放大鼠标框选区域的图片",lang:"zh-CN",frontmatter:{title:"放大鼠标框选区域的图片",date:"2021-10-31",categories:["H5"],tags:["H5","Canvas","Vue"]},excerpt:"",headers:[{level:2,title:"1.加入 Canvas 元素",slug:"_1-加入-canvas-元素",children:[]},{level:2,title:"2.声明全局变量",slug:"_2-声明全局变量",children:[]},{level:2,title:"3.在页面的 dom 渲染完成做事件监听",slug:"_3-在页面的-dom-渲染完成做事件监听",children:[]},{level:2,title:"4.事件处理函数",slug:"_4-事件处理函数",children:[]}],git:{},filePathRelative:"frontend/canvas-zoom-img-by-selecting-area.md"}},4386:(n,s,a)=>{a.r(s),a.d(s,{default:()=>k});var t=a(6252);const p=(0,t._)("h1",{id:"放大鼠标框选区域的图片",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#放大鼠标框选区域的图片","aria-hidden":"true"},"#"),(0,t.Uk)(" 放大鼠标框选区域的图片")],-1),o=(0,t._)("p",null,"使用 Canvas 显示图片，通过鼠标选中 Canvas 内的一个矩形区域，松开鼠标后将该矩形内的内容以最适应 Canvas 框大小的方式来显示。基于 Vue 的写法。",-1),e=(0,t._)("p",null,"示例:",-1),c=(0,t._)("p",null,[(0,t._)("img",{src:"/blog_images/canvas-zoom-img-by-selecting-area/1.gif",alt:"1"})],-1),l={class:"table-of-contents"},u=(0,t.uE)('<h2 id="_1-加入-canvas-元素" tabindex="-1"><a class="header-anchor" href="#_1-加入-canvas-元素" aria-hidden="true">#</a> 1.加入 Canvas 元素</h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvasContainer<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span><span class="token property">overflow</span><span class="token punctuation">:</span>auto</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    Sorry, your browser does not support HTML5 Canvas functionality which is\n    required for this application.\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-声明全局变量" tabindex="-1"><a class="header-anchor" href="#_2-声明全局变量" aria-hidden="true">#</a> 2.声明全局变量</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token literal-property property">zoomRate</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n      <span class="token comment">// canvas拖拽放大缩小</span>\n      <span class="token literal-property property">canvas</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">offscreenCanvas</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">offscreenContext</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">mousedown</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">rubberbandRectangle</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">dragging</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">scaleRate</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n      <span class="token literal-property property">mousemove</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-在页面的-dom-渲染完成做事件监听" tabindex="-1"><a class="header-anchor" href="#_3-在页面的-dom-渲染完成做事件监听" aria-hidden="true">#</a> 3.在页面的 dom 渲染完成做事件监听</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 初始化canvas对象</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousedown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 开始框选</span>\n      <span class="token keyword">let</span> loc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">windowToCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取鼠标点击在canvas的坐标</span>\n      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>x <span class="token operator">=</span> loc<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>y <span class="token operator">=</span> loc<span class="token punctuation">.</span>y<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>y<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>dragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 框选中</span>\n      <span class="token keyword">let</span> loc <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dragging<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">,</span>\n          <span class="token number">0</span><span class="token punctuation">,</span>\n          <span class="token number">0</span><span class="token punctuation">,</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height\n        <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//把离屏canvas上的数据复制到当前canvas</span>\n        loc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">windowToCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rubberbandStretch</span><span class="token punctuation">(</span>loc<span class="token punctuation">.</span>x<span class="token punctuation">,</span> loc<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算出选中的矩形坐标</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 记录非点击状态下鼠标的位置，为定点缩放做准备</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>mousemove <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">windowToCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function-variable function">onmouseup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 结束框选</span>\n      <span class="token keyword">let</span> loc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">windowToCanvas</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rubberbandEnd</span><span class="token punctuation">(</span>loc<span class="token punctuation">.</span>x<span class="token punctuation">,</span> loc<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//鼠标抬起 开始从离屏canvas复制数据</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-事件处理函数" tabindex="-1"><a class="header-anchor" href="#_4-事件处理函数" aria-hidden="true">#</a> 4.事件处理函数</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> canvasContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvasContainer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>canvasContainer <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageData<span class="token punctuation">;</span>\n          img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 获得body当前的尺寸，计算出缩放比例，对高度做限制</span>\n            <span class="token comment">// 使用原尺寸高度，在默认状态下会出现上下滚动条 canvasContainer.offsetHeight,略丑</span>\n            <span class="token keyword">const</span> heightScaleRate <span class="token operator">=</span>\n              <span class="token punctuation">(</span>canvasContainer<span class="token punctuation">.</span>offsetHeight <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">/</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>\n            <span class="token keyword">const</span> widthScaleRate <span class="token operator">=</span>\n              <span class="token punctuation">(</span>canvasContainer<span class="token punctuation">.</span>offsetWidth <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">/</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n            <span class="token comment">// 选取比率小的，以防超过边界出现滚动条</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">=</span>\n              heightScaleRate <span class="token operator">&gt;</span> widthScaleRate\n                <span class="token operator">?</span> widthScaleRate\n                <span class="token operator">:</span> heightScaleRate<span class="token punctuation">;</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>\n              img<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>\n              img<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>\n              img<span class="token punctuation">,</span>\n              <span class="token number">0</span><span class="token punctuation">,</span>\n              <span class="token number">0</span><span class="token punctuation">,</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenContext<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>\n              img<span class="token punctuation">,</span>\n              <span class="token number">0</span><span class="token punctuation">,</span>\n              <span class="token number">0</span><span class="token punctuation">,</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">.</span>height\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">windowToCanvas</span><span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> bbox <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token punctuation">{</span>\n        <span class="token literal-property property">x</span><span class="token operator">:</span> x <span class="token operator">-</span> bbox<span class="token punctuation">.</span>left<span class="token punctuation">,</span>\n        <span class="token literal-property property">y</span><span class="token operator">:</span> y <span class="token operator">-</span> bbox<span class="token punctuation">.</span>top<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">rubberbandStretch</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>left <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>top <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mousedown<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;rgba(96,98,102,0.3)&quot;</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>left<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>top<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>width<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>height\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">rubberbandEnd</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>\n        x <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>left <span class="token operator">||</span>\n        y <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>top\n      <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>dragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 获取在原图里的尺寸</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>offscreenCanvas<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>left <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>top <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">,</span>\n        <span class="token number">0</span><span class="token punctuation">,</span>\n        <span class="token number">0</span><span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate<span class="token punctuation">,</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rubberbandRectangle<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleRate <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomRate\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> base64Img <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">&quot;image/jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>imageData <span class="token operator">=</span> base64Img<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span>dragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可通过按钮、框选、滚轮滚动来放大缩小图片的示例：</p>',9),i={},k=(0,a(3744).Z)(i,[["render",function(n,s){const a=(0,t.up)("RouterLink"),i=(0,t.up)("canvas-zoom-img");return(0,t.wg)(),(0,t.iD)(t.HY,null,[p,o,e,c,(0,t._)("nav",l,[(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_1-加入-canvas-元素"},{default:(0,t.w5)((()=>[(0,t.Uk)("1.加入 Canvas 元素")])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_2-声明全局变量"},{default:(0,t.w5)((()=>[(0,t.Uk)("2.声明全局变量")])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_3-在页面的-dom-渲染完成做事件监听"},{default:(0,t.w5)((()=>[(0,t.Uk)("3.在页面的 dom 渲染完成做事件监听")])),_:1})]),(0,t._)("li",null,[(0,t.Wm)(a,{to:"#_4-事件处理函数"},{default:(0,t.w5)((()=>[(0,t.Uk)("4.事件处理函数")])),_:1})])])]),u,(0,t.Wm)(i)],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);