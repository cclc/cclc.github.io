"use strict";(self.webpackChunkcclc_vuepress=self.webpackChunkcclc_vuepress||[]).push([[533],{5656:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-77a6dae1",path:"/vue/bokeh-vue.html",title:"bokeh + vue",lang:"zh-CN",frontmatter:{title:"bokeh + vue",date:"2018-12-27",categories:["Vue"],tags:["Vue","Bokeh"]},excerpt:"",headers:[],git:{},filePathRelative:"vue/bokeh-vue.md"}},6052:(n,s,a)=>{a.r(s),a.d(s,{default:()=>v});var t=a(6252);const p=(0,t._)("h1",{id:"bokeh-vue",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#bokeh-vue","aria-hidden":"true"},"#"),(0,t.Uk)(" bokeh + vue")],-1),e=(0,t._)("p",null,[(0,t.Uk)("2019/3/6 更新"),(0,t._)("br"),(0,t.Uk)(" 修改了 js 和 css 的加载方式，具体代码的修改看 github。"),(0,t._)("br"),(0,t.Uk)(" 原本的思路其实无法解决 bokeh 的前端后台版本不同的问题。")],-1),o=(0,t._)("br",null,null,-1),c=(0,t._)("br",null,null,-1),l={href:"https://www.npmjs.com/package/bokeh-vue",target:"_blank",rel:"noopener noreferrer"},u=(0,t._)("br",null,null,-1),i=(0,t._)("br",null,null,-1),r={href:"https://github.com/cclc/bokeh-vue",target:"_blank",rel:"noopener noreferrer"},k=(0,t.uE)('<p>原文:<br> bokeh 是 python 用来生成图表的库，类似于百度的 echart，不过 bokeh 和后台代码结合的更紧密些，可以直接导出 html 文件。<br> 在 vue 里显示 bokeh 的图表有两种办法:<br><strong>1.使用 iframe 加载 bokeh 导出的 html 文件</strong><br> 缺点：<br> ① 因为不知道 html 内容的高度，事先定义高度的话会有滚动条，不美观<br> ② 同时加载多个 iframe 时会造成页面的卡死，我本地加载 5 个页面会卡大概 10 秒，因为无法知道 iframe 内的内容什么时候加载完成，所以我也没法做 loading 界面去掩饰页面卡死<br> 优点：<br> ① 简单！<br><strong>2.把 bokeh 的 div 和 script 传给页面，在页面上进行渲染</strong><br> 使用 bokeh 的 components 功能，将 div 和 js 从 plotting 里分离出来<br> python 的相关代码如下：</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>script<span class="token punctuation">,</span> div <span class="token operator">=</span> components<span class="token punctuation">(</span>p<span class="token punctuation">,</span> wrap_script<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">:</span>div<span class="token punctuation">,</span> <span class="token string">&#39;script&#39;</span><span class="token punctuation">:</span>script<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>wrap_script=false 是将原本包在 js 代码外的&lt; script &gt;标签删除，我选择了删除，因为我在页面添加节点的时候会手动加入 script 标签<br> 在 vue 的 template 里没法加入 script 标签，所以我需要通过在 body 下动态地添加 script 的方式来运行 bokeh 的 js 代码<br> vue 的相关代码如下:</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- 通过v-html在template里加入bokeh的div --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 在头部插入css代码</span>\n<span class="token comment">// 因为要保持前端和后台的bokeh版本一致，所以使用了拼接cdn路径的方式</span>\n<span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nlink<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;rel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nlink<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>\n  <span class="token string">&quot;href&quot;</span><span class="token punctuation">,</span>\n  <span class="token string">&quot;https://cdn.pydata.org/bokeh/release/bokeh-&quot;</span> <span class="token operator">+</span> bokehVersion <span class="token operator">+</span> <span class="token string">&quot;.min.css&quot;</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\nlink<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 在头部插入js代码</span>\n<span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nscript<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>\n  <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span>\n  <span class="token string">&quot;https://cdn.pydata.org/bokeh/release/bokeh-&quot;</span> <span class="token operator">+</span> bokehVersion <span class="token operator">+</span> <span class="token string">&quot;.min.js&quot;</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\nscript<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// cdn的js加载完毕后再请求bokeh参数</span>\nscript<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  _this<span class="token punctuation">.</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/yourUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    _this<span class="token punctuation">.</span>html <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>div<span class="token punctuation">;</span>\n    <span class="token comment">// 插入绘制script代码</span>\n    <span class="token keyword">let</span> bokehRunScript <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;SCRIPT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    bokehRunScript<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    bokehRunScript<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>bokehRunScript<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 绘制代码执行完后关闭等待画面</span>\n    _this<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>缺点：<br> ① 相比 iframe 方式要多写代码<br> 优点：<br> ① 性能更好，每次只传输所需的内容，数据包小<br> ② 显示更好，没有上下滚动条了<br> ③ 体验更好，可以加入 Loading 画面了</p><p><strong>踩坑点：</strong><br> ①npm 上的 vue-bokeh 库是不能用的<br> 它通过在 template 里添加 script 标签来运行 bokeh 的 js 代码，首先编译就通不过，不过它提供给我了 components 的思路</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>\n  {{{plot.div}}}\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n    <span class="token punctuation">{</span>\n      <span class="token punctuation">{</span>\n        <span class="token punctuation">{</span>\n          plot<span class="token punctuation">.</span>script<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">plot</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>② 注意前端和后台的 bokeh 版本，版本不同会有渲染问题<br> ③ 我有试过用 eval()的方式运行 bokeh 的 js，可能因为作用域的问题无法正常运行</p><p><strong>如果有相关问题可以<a href="mailto:luchen111@vip.qq.com">联系我</a></strong></p>',10),d={},v=(0,a(3744).Z)(d,[["render",function(n,s){const a=(0,t.up)("ExternalLinkIcon");return(0,t.wg)(),(0,t.iD)(t.HY,null,[p,e,(0,t._)("p",null,[(0,t.Uk)("2018/12/29 更新"),o,(0,t.Uk)(" 我封装了一个 npm 包"),c,(0,t._)("a",l,[(0,t.Uk)("https://www.npmjs.com/package/bokeh-vue"),(0,t.Wm)(a)]),u,(0,t.Uk)(" 对应的 github 地址"),i,(0,t._)("a",r,[(0,t.Uk)("https://github.com/cclc/bokeh-vue"),(0,t.Wm)(a)])]),k],64)}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);